<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>GRUDICOM TI & GPS | C4 - ADMIN FIX</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        :root { --bg-main: #f0f4f8; --header-bg: #002a61; }
        body { background: var(--bg-main); font-family: 'Segoe UI', sans-serif; font-size: 0.75rem; margin: 0; }
        .header-bar { background: white; padding: 10px 20px; border-bottom: 4px solid var(--header-bg); display: flex; justify-content: space-between; align-items: center; }
        .cliente-header { background: #336699; color: white; padding: 8px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header-bar">
    <div class="d-flex align-items-center">
        <img src="TIGPS HD2.png" alt="Logo" style="height: 40px;" class="me-3">
        <h5 class="fw-bold m-0 text-primary">GRUDICOM TI & GPS</h5>
    </div>
    <div class="d-flex align-items-center">
        <button class="btn btn-danger btn-sm fw-bold me-2" data-bs-toggle="modal" data-bs-target="#modalAdmin">ADMIN</button>
        <button class="btn btn-primary btn-sm fw-bold" onclick="location.reload()"><i class="fa-solid fa-power-off"></i></button>
    </div>
</div>

<div class="container-fluid mt-3">
    <div class="card shadow-sm border-0">
        <table class="table table-bordered text-center align-middle mb-0">
            <tbody id="tabla-clientes">
                <tr><td class="p-5 text-muted">Base de datos lista. Usa el botÃ³n ADMIN para configurar Clientes y Tokens.</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="modalAdmin" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content">
    <div class="modal-header bg-danger text-white"><h6>CONFIGURACIÃ“N MAESTRA (REINICIO)</h6><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
    <div class="modal-body small">
        <div class="row">
            <div class="col-6 border-end">
                <h6>1. Agregar Cliente</h6>
                <div class="input-group mb-3"><input type="text" id="c_nom" class="form-control" placeholder="Ej. DSG"><button class="btn btn-success" onclick="addCli()">AÃ±adir</button></div>
            </div>
            <div class="col-6">
                <h6>2. Agregar Token GPS</h6>
                <input type="text" id="t_nom" class="form-control mb-1" placeholder="Nombre Flota">
                <input type="text" id="t_val" class="form-control mb-2" placeholder="Token Wialon">
                <input type="text" id="t_url" class="form-control mb-2" placeholder="URL (RACEL usa host propio)" value="https://hst-api.wialon.com">
                <button class="btn btn-primary w-100" onclick="addTk()">Guardar Token</button>
            </div>
        </div>
    </div>
</div></div></div>

<script>
    // CORRECCIÃ“N DE INICIALIZACIÃ“N
    const firebaseConfig = { databaseURL: "https://monitoreo-logistica-default-rtdb.firebaseio.com/" };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function addCli() {
        const n = document.getElementById("c_nom").value.toUpperCase();
        if(n) db.ref('clientes').push({nombre: n});
        document.getElementById("c_nom").value = "";
    }

    function addTk() {
        const n = document.getElementById("t_nom").value.toUpperCase();
        const v = document.getElementById("t_val").value;
        const u = document.getElementById("t_url").value;
        if(n && v) db.ref('sistema/tokens').push({nombre: n, token: v, url: u});
        alert("Token guardado correctamente");
    }

    // Escuchar clientes para ver que funcione
    db.ref('clientes').on('value', s => {
        const clis = s.val() || {};
        const tbody = document.getElementById("tabla-clientes");
        tbody.innerHTML = "";
        Object.keys(clis).forEach(id => {
            tbody.innerHTML += `<tr><td class="cliente-header text-start">ðŸ“¦ CLIENTE: ${clis[id].nombre}</td></tr>`;
        });
    });
</script>
</body>
</html>
